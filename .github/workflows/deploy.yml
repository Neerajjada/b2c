name: test 

on:
  push:
    branches:
      - main

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v1
      - name: Replace Variables in Policy Files
        run: >
          mkdir -p build
<<<<<<< HEAD
          # Normalize line endings in dev.config for compatibility
          sed -i 's/\r//' src/configuration/dev.config

          # Replace variables in XML files located in the 'policies' folder
          while IFS= read -r line || [ -n "$line" ]; do
            if [[ ! "$line" =~ : ]]; then continue; fi
            IFS=':' read -ra KV <<< "$line"
            key=$(echo "${KV[0]}" | xargs)
            value=$(echo "${KV[1]}" | xargs)
            echo "Replacing {{$key}} with $value"
            find src/policies -type f -name "*.xml" -exec sed -i "s|{{$key}}|$value|g" {} \;
          done < src/configuration/dev.config

          # Copy updated files to the build directory
=======
            # Normalize line endings in dev.config for compatibility
          sed -i 's/\r//' src/configuration/dev.config
            # Replace variables in XML files located in the 'Policies' folder
          while IFS= read -r line || [ -n "$line" ]; do
          if [[ ! "$line" =~ : ]]; then continue; fi
          IFS=':' read -ra KV <<< "$line"
          key=$(echo "${KV[0]}" | xargs)
          value=$(echo "${KV[1]}" | xargs)
          echo "Replacing {{$key}} with $value"
          find policies -type f -name "*.xml" -exec sed -i "s|{{$key}}|$value|g" {} \;
          done < configuration/dev.config
             # Copy updated files to the build directory
>>>>>>> 62f535d46f027c8d440353c6a32651f8090308e4
          cp src/policies/*.xml build/
      - name: Debug Policies
        run: |
          echo "Updated Policies:"
          cat ./build/*.xml
          ls -alrt ./build
          pwd
        shell: bash
